# =============================================================================
# Data Insights Portal - Optimized Application Configuration
# =============================================================================

# Server configuration
server.port=${PORT:8082}

# =============================================================================
# DATABASE CONFIGURATION (Auto-switches between Local SQL Server and Railway PostgreSQL)
# =============================================================================

# Default (Local Development) - SQL Server
spring.datasource.url=${DATABASE_URL:jdbc:sqlserver://localhost;databaseName=DataInsightsDB;encrypt=true;trustServerCertificate=true;}
spring.datasource.username=${DB_USERNAME:datainsights_user}
spring.datasource.password=${DB_PASSWORD:SecurePassword123!}
spring.datasource.driver-class-name=${DB_DRIVER:com.microsoft.sqlserver.jdbc.SQLServerDriver}

# JPA Configuration
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=${JPA_SHOW_SQL:false}
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.dialect=${JPA_DIALECT:org.hibernate.dialect.SQLServerDialect}

# =============================================================================
# MONGODB CONFIGURATION
# =============================================================================

# MongoDB Atlas (Your existing connection)
spring.data.mongodb.uri=${MONGODB_URI:mongodb+srv://datainsights_user:G0qb1QbCw79eblaX@cluster0.dfgo0al.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0}
spring.data.mongodb.database=${MONGODB_DATABASE:dataInsights}

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================

# JWT Configuration
jwt.secret=${JWT_SECRET:your_secure_key_for_data_insights_portal_authentication_make_this_longer_and_more_secure_for_production}
jwt.expiration=${JWT_EXPIRATION:86400000}

# =============================================================================
# FILE UPLOAD CONFIGURATION
# =============================================================================

spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB
file.upload-dir=${UPLOAD_DIR:./uploads}

# =============================================================================
# LOGGING CONFIGURATION (Optimized for memory)
# =============================================================================

logging.level.org.springframework.web=${LOG_LEVEL_WEB:WARN}
logging.level.org.springframework.security=${LOG_LEVEL_SECURITY:WARN}
logging.level.org.springframework=${LOG_LEVEL_SPRING:WARN}
logging.level.org.hibernate=${LOG_LEVEL_HIBERNATE:WARN}
logging.level.com.zaxxer.hikari=${LOG_LEVEL_HIKARI:WARN}
logging.level.com.datainsights=${LOG_LEVEL_APP:INFO}
logging.level.root=${LOG_LEVEL_ROOT:WARN}

# =============================================================================
# PERFORMANCE OPTIMIZATIONS
# =============================================================================

# JPA Optimizations
spring.jpa.open-in-view=false
spring.jpa.hibernate.connection.pool_size=5

# Database Connection Pool
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.connection-timeout=20000

# Server Optimizations
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
server.compression.min-response-size=1024
server.tomcat.max-threads=50
server.tomcat.min-spare-threads=5

# Actuator Configuration
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=when-authorized

# =============================================================================
# PROFILE-SPECIFIC CONFIGURATIONS
# =============================================================================

---
# Local Development Profile
spring.config.activate.on-profile=local

# Local SQL Server Configuration
spring.datasource.url=jdbc:sqlserver://localhost;databaseName=DataInsightsDB;encrypt=true;trustServerCertificate=true;
spring.datasource.username=datainsights_user
spring.datasource.password=SecurePassword123!
spring.datasource.driver-class-name=com.microsoft.sqlserver.jdbc.SQLServerDriver
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.SQLServerDialect

# Development Logging
spring.jpa.show-sql=true
logging.level.org.springframework.web=DEBUG
logging.level.com.datainsights=DEBUG

# File upload for local development
file.upload-dir=./uploads

---
# Railway Production Profile - Memory Optimized
spring.config.activate.on-profile=railway

# Railway PostgreSQL Configuration (automatically provided by Railway)
# Convert Railway URL format to JDBC format
spring.datasource.url=jdbc:${DATABASE_URL}
spring.datasource.driver-class-name=org.postgresql.Driver
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# Disable MongoDB temporarily to save memory
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration,org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration

# Production Logging - Minimal
spring.jpa.show-sql=false
logging.level.org.springframework=WARN
logging.level.org.hibernate=WARN
logging.level.com.zaxxer.hikari=WARN
logging.level.com.datainsights=INFO
logging.level.root=WARN

# Production file upload
file.upload-dir=/tmp/uploads

# Production Security
jwt.secret=${JWT_SECRET}

# Memory Optimizations
spring.devtools.restart.enabled=false
server.error.include-stacktrace=never
server.error.include-message=never

# Smaller connection pools for Railway
spring.datasource.hikari.maximum-pool-size=3
spring.datasource.hikari.minimum-idle=1
server.tomcat.max-threads=20
server.tomcat.min-spare-threads=2