# =============================================================================
# Data Insights Portal - Final Optimized Configuration
# =============================================================================

# Server configuration
server.port=${PORT:8082}

# =============================================================================
# PERFORMANCE OPTIMIZATIONS FOR RAILWAY 512MB LIMIT
# =============================================================================

# JVM Memory Settings (handled in railway.json)
# -Xmx400m -XX:+UseG1GC -XX:+UseStringDeduplication

# =============================================================================
# DATABASE CONFIGURATION (Auto-switches between Local SQL Server and Railway PostgreSQL)
# =============================================================================

# Default (Local Development) - SQL Server
spring.datasource.url=${DATABASE_URL:jdbc:sqlserver://localhost;databaseName=DataInsightsDB;encrypt=true;trustServerCertificate=true;}
spring.datasource.username=${DB_USERNAME:datainsights_user}
spring.datasource.password=${DB_PASSWORD:SecurePassword123!}
spring.datasource.driver-class-name=${DB_DRIVER:com.microsoft.sqlserver.jdbc.SQLServerDriver}

# JPA Configuration
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.dialect=${JPA_DIALECT:org.hibernate.dialect.SQLServerDialect}

# =============================================================================
# MONGODB CONFIGURATION (Disabled on Railway to save memory)
# =============================================================================

# MongoDB Atlas (Your existing connection) - Only for local
spring.data.mongodb.uri=${MONGODB_URI:mongodb://localhost:27017/dataInsights}
spring.data.mongodb.database=${MONGODB_DATABASE:dataInsights}

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================

# JWT Configuration
jwt.secret=${JWT_SECRET:your_secure_key_for_data_insights_portal_authentication}
jwt.expiration=${JWT_EXPIRATION:86400000}

# =============================================================================
# FILE UPLOAD CONFIGURATION
# =============================================================================

spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=5MB
spring.servlet.multipart.max-request-size=5MB
file.upload-dir=${UPLOAD_DIR:./uploads}

# =============================================================================
# MEMORY-OPTIMIZED LOGGING
# =============================================================================

logging.level.org.springframework=WARN
logging.level.org.hibernate=ERROR
logging.level.com.zaxxer.hikari=ERROR
logging.level.com.datainsights=INFO
logging.level.root=WARN

# =============================================================================
# AGGRESSIVE PERFORMANCE OPTIMIZATIONS
# =============================================================================

# JPA Optimizations
spring.jpa.open-in-view=false
spring.jpa.hibernate.connection.pool_size=2

# Minimal Database Connection Pool
spring.datasource.hikari.maximum-pool-size=2
spring.datasource.hikari.minimum-idle=1
spring.datasource.hikari.connection-timeout=10000
spring.datasource.hikari.idle-timeout=300000

# Minimal Server Configuration
server.compression.enabled=true
server.tomcat.max-threads=10
server.tomcat.min-spare-threads=2
server.tomcat.max-connections=50

# Actuator - Health Check Only
management.endpoints.web.exposure.include=health
management.endpoint.health.show-details=never

# =============================================================================
# PROFILE-SPECIFIC CONFIGURATIONS
# =============================================================================

---
# Local Development Profile
spring.config.activate.on-profile=local

# Local SQL Server Configuration
spring.datasource.url=jdbc:sqlserver://localhost;databaseName=DataInsightsDB;encrypt=true;trustServerCertificate=true;
spring.datasource.username=datainsights_user
spring.datasource.password=SecurePassword123!
spring.datasource.driver-class-name=com.microsoft.sqlserver.jdbc.SQLServerDriver
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.SQLServerDialect

# Development Logging
spring.jpa.show-sql=true
logging.level.org.springframework.web=DEBUG
logging.level.com.datainsights=DEBUG

# MongoDB enabled for local
spring.data.mongodb.uri=mongodb://localhost:27017/dataInsights

---
# Railway Production Profile - Ultra Memory Optimized
spring.config.activate.on-profile=railway

# DISABLE MONGODB COMPLETELY TO SAVE MEMORY
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration,org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration

# Railway PostgreSQL - Handle URL format properly
spring.datasource.url=${DATABASE_URL}
spring.datasource.driver-class-name=org.postgresql.Driver
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# Ultra minimal logging for memory
logging.level.org.springframework=ERROR
logging.level.org.hibernate=ERROR
logging.level.com.zaxxer.hikari=ERROR
logging.level.com.datainsights=WARN
logging.level.root=ERROR

# Memory optimizations
spring.devtools.restart.enabled=false
server.error.include-stacktrace=never
server.error.include-message=never

# Absolute minimal connection pool
spring.datasource.hikari.maximum-pool-size=1
spring.datasource.hikari.minimum-idle=1
server.tomcat.max-threads=5
server.tomcat.min-spare-threads=1